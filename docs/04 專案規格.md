# OCR Pipeline - Python 專案結構規劃

> **注意**：本文件描述的是**規劃中的專案目錄結構**，用於指導後續實作。
> 目前工作區僅包含設計文件，實際程式碼尚未開發。

## 文件目的

本文件整合三份規格文件（[`01 設計架構.md`]、[`02 API規格.md`]、[`03 作業範本規格.md`]），
提供一個**可直接落地的 Python 專案骨架**，結構清楚、可擴充、可插拔。

---

# 1️⃣ Python 專案目錄結構（規劃）

```
ocr_pipeline/
├── '00 初步構想.md'
├── '01 設計架構.md'
├── '02 API規格.md'
├── '03 作業範本規格.md'
├── '04 專案規格.md'
├── README.md
├── pyproject.toml / setup.py
├── requirements.txt
├── config/
│   └── templates/           # JSON Template 放置資料夾
├── ocr_pipeline/
│   ├── __init__.py
│   ├── main.py              # CLI / pipeline 啟動入口
│   ├── api/
│   │   ├── __init__.py
│   │   ├── server.py        # FastAPI 或 Flask
│   │   ├── schemas.py       # Request / Response schema
│   │   └── routes.py
│   ├── adapters/
│   │   ├── __init__.py
│   │   ├── input_adapter.py # PDF/DOCX/TIFF → image
│   │   ├── ocr_adapter.py   # PaddleOCR / Tesseract Adapter
│   │   └── storage_adapter.py # 輸出與 artifact 管理
│   ├── core/
│   │   ├── __init__.py
│   │   ├── orchestrator.py  # Pipeline orchestrator
│   │   ├── pipeline.py      # Preprocess pipeline
│   │   └── steps/           # 各處理步驟
│   │       ├── __init__.py
│   │       ├── load_image.py
│   │       ├── resize_normalize.py
│   │       ├── deskew.py
│   │       ├── denoise.py
│   │       ├── binarize.py
│   │       └── roi_extractor.py
│   ├── template/
│   │   ├── __init__.py
│   │   ├── loader.py        # Template JSON Loader
│   │   └── validator.py     # Template schema 驗證
│   └── utils/
│       ├── __init__.py
│       ├── image_utils.py
│       └── file_utils.py
├── tests/
│   ├── test_pipeline.py
│   ├── test_adapters.py
│   └── test_templates.py
```

---

# 2️⃣ 核心模組說明

### 2.1 `ocr_pipeline/core/pipeline.py`

* 定義 **Preprocess Pipeline Base Class**
* 管理 Step 執行順序
* 每個 Step 接收 `context`，並回傳更新後 `context`

### 2.2 `ocr_pipeline/core/steps/`

* 每個檔案一個處理步驟
* Step Base Class 範例：

```python
class PreprocessStep:
    def run(self, context: dict) -> dict:
        """執行步驟"""
        raise NotImplementedError
```

---

### 2.3 `ocr_pipeline/adapters/input_adapter.py`

* 負責檔案格式轉換（PDF / DOCX / TIFF → PNG）
* 輸出標準化 image path 與 metadata

---

### 2.4 `ocr_pipeline/adapters/ocr_adapter.py`

* OCR Engine 抽象層
* 提供統一接口：

```python
class OCREngine:
    def recognize(self, image_path: str, lang: str) -> dict:
        """回傳 OCR 結果 JSON"""
        raise NotImplementedError
```

* 可實作 PaddleOCR Adapter 或 Tesseract Adapter

---

### 2.5 `ocr_pipeline/template/loader.py`

* 負責載入 Template JSON
* 回傳 `Template` 物件
* 支援 schema 驗證

---

### 2.6 `ocr_pipeline/api/`

* 提供 REST API
* **對應 `02 API規格.md`：**

  * POST `/ocr/recognize`（同步）
  * POST `/ocr/jobs` + GET `/ocr/jobs/{id}`（非同步）
* 使用 FastAPI 或 Flask

---

### 2.7 `ocr_pipeline/adapters/storage_adapter.py`

* 管理輸出路徑、artifact
* 儲存裁切後 ROI、OCR JSON、前處理影像

---

# 3️⃣ Template 管理 (`config/templates/`)

* 每個 Template JSON 對應一個文件版型
* 可放置多個 template
* Loader + Validator 讀入 pipeline 使用

---

# 4️⃣ 測試框架 (`tests/`)

* `pytest` 或 `unittest`
* 建議覆蓋：

  * Pipeline Step
  * Adapter
  * Template Loader
  * API 呼叫

---

# 5️⃣ 開發建議

1. **先實作 Base Class 與 Loader**
2. **實作 2~3 個 Preprocess Step**
3. **實作 Input Adapter**
4. **實作 OCR Adapter（PaddleOCR）**
5. **組成 orchestrator → 測試完整 Pipeline**
6. **最後接 FastAPI / Flask API 層**

---

