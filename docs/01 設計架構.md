# OCR 系統架構設計文件

## 1. 文件目的

本文件描述 OCR 系統的 **整體架構設計、模組分層與責任劃分**，
作為系統實作、擴充與技術決策的依據。

---

## 2. 系統設計目標

- 支援多格式文件 OCR
- 前處理流程與 OCR 引擎解耦
- 支援多文件版型（Template）
- 可批次、可非同步處理
- 中間結果可追蹤與重現

---

## 3. 系統整體架構

```
┌──────────────────────────────┐
│        Client / API          │
└──────────────┬───────────────┘
               ▼
┌──────────────────────────────┐
│  OCR Pipeline Orchestrator   │
│    (流程控制 / 任務狀態)      │
└──────────────┬───────────────┘
               ▼
┌──────────────────────────────┐
│        Input Adapter         │
│    (格式轉換 / 影像標準化)    │
└──────────────┬───────────────┘
               ▼
┌──────────────────────────────┐
│   Preprocess Pipeline        │
│   (校正 / 去噪 / ROI 切割)    │
└──────────────┬───────────────┘
               ▼
┌──────────────────────────────┐
│   OCR Engine Adapter         │
│ (PaddleOCR / Tesseract ...)  │
└──────────────┬───────────────┘
               ▼
┌──────────────────────────────┐
│    Post-processing Layer     │
│    (校驗 / 正則 / 結構化)     │
└──────────────┬───────────────┘
               ▼
┌──────────────────────────────┐
│      Output & Storage        │
└──────────────────────────────┘
```

---

## 4. 模組分層說明

### 4.1 API Layer
- 提供同步 / 非同步 OCR 服務
- 驗證輸入、回傳 job 狀態

---

### 4.2 Pipeline Orchestrator
- 控制 pipeline 執行順序
- 管理 job 狀態
- 分派背景任務（Worker）

---

### 4.3 Input Adapter
- 負責檔案格式轉換
- 統一輸出為影像格式（PNG / JPEG）

---

### 4.4 Preprocess Pipeline
- 影像尺寸正規化
- 幾何校正（deskew / perspective）
- 去噪、二值化
- ROI 切割

---

### 4.5 OCR Engine Adapter
- 封裝 OCR 引擎實作
- 提供統一 OCR 介面

---

### 4.6 Post-processing
- OCR 結果清洗與驗證
- 結構化輸出

---

### 4.7 Output & Artifact
- 儲存結果與中間影像
- 支援除錯與模型優化

---

## 5. 擴充性設計

| 擴充需求 | 擴充方式 |
|--------|--------|
| 新 OCR 引擎 | 新 Adapter |
| 新版型 | 新 Template |
| 新前處理 | 新 Step |
| 新輸入格式 | 新 Input Adapter |

---

## 6. 非功能性需求

- 可觀測性（Job 狀態）
- 可測試性（Step 單元測試）
- 高可維護性（低耦合）

---

